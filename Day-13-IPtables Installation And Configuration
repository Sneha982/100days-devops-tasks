Day 13: IPtables Installation And Configuration
We have one of our websites up and running on our Nautilus infrastructure in Stratos DC. Our security team has raised a concern that right now Apache’s port i.e 5001 is open for all since there is no firewall installed on these hosts. So we have decided to add some security layer for these hosts and after discussions and recommendations we have come up with the following requirements:

Install iptables and all its dependencies on each app host.
Block incoming port 5001 on all apps for everyone except for LBR host.
Make sure the rules remain, even after system reboot.
Details:

App Server 1 → stapp01
IP: 172.16.238.10
Hostname: stapp01.stratos.xfusioncorp.com
SSH User: tony
Application: Nautilus App 1

App Server 2 → stapp02
IP: 172.16.238.11
Hostname: stapp02.stratos.xfusioncorp.com
SSH User: steve
Application: Nautilus App 2

App Server 3 → stapp03
IP: 172.16.238.12
Hostname: stapp03.stratos.xfusioncorp.com
SSH User: banner
Application: Nautilus App 3

Solution:

SSH into all app servers and gain root privileges:

ssh tony@stapp01
ssh steve@stapp02
ssh banner@stapp03
sudo -i
Install and enable iptables:

yum install -y iptables-services
systemctl start iptables
systemctl enable iptables
Configure rules to allow only LBR host and drop others:

iptables -A INPUT -p tcp --dport 5001 -s 172.16.238.14 -j ACCEPT
iptables -A INPUT -p tcp --dport 5001 -j DROP
iptables -L --line-numbers
iptables -R INPUT 5 -p icmp -j REJECT
iptables -L --line-numbers
service iptables save
systemctl restart iptables
systemctl status iptables
This secures port 5001 while keeping LBR access intact and persists across reboot.

Verify:

curl http://stapp01:5001
curl http://stapp02:5001
curl http://stapp03:5001
Result:
Only the LBR host can access port 5001; other sources are blocked.

